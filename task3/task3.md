# Название задачи: Концептуальная архитектура MVP для открытия депозитов онлайн

# Автор: Команда цифровой трансформации

# Дата: 06 мая 2025

# Функциональные требования

Таблица Use Cases покрывает все функциональные требования из FURPS+ (F1.1–F5.2). Use Case 6 ("Проверка достаточности средств") исключён, так как проверка баланса встроена в АБС и интегрирована в Use Case 8 ("Регистрация депозита"). Колонка **Покрываемое требование** связывает каждый Use Case с соответствующим требованием.

| **№** | **Действующие лица или системы** | **Use Case** | **Описание** | **Покрываемое требование** |
| :-: | :- | :- | :- | :- |
| 1 | Клиент | Аутентификация в интернет-банке | Клиент проходит аутентификацию в интернет-банке с использованием логина, пароля или биометрии. | F2.3 (неявно поддерживает подачу заявки) |
| 2 | Клиент, Веб-сайт | Просмотр депозитных продуктов на сайте | Клиент запрашивает список депозитных продуктов на сайте. Deposit System отображает актуальные условия (ставки, сроки, минимальную сумму). | F1.1 |
| 3 | Клиент, Интернет-банк | Просмотр депозитных продуктов и счетов в интернет-банке | Клиент запрашивает список депозитных продуктов и своих депозитных счетов. Deposit System отображает условия, включая персонализированные ставки на основе данных клиента из АБС, и данные счетов. | F2.1, F2.2, F2.3 |
| 4 | Клиент, Веб-сайт | Подача заявки через сайт | Клиент заполняет форму на сайте, указывая Ф.И.О. и телефон, для подачи заявки на депозит. Deposit System передаёт заявку в систему колл-центра через Kafka. | F1.2 |
| 5 | Клиент, Интернет-банк | Выбор депозитного продукта | Клиент выбирает депозитный продукт в интернет-банке, указывает счёт, сумму и срок. Deposit System инициирует обработку заявки. | F2.3 |
| 6 | Клиент, Интернет-банк | Подтверждение заявки через СМС-код | Клиент подтверждает параметры депозита в интернет-банке с помощью СМС-кода. Deposit System координирует подтверждение. | F2.4 |
| 7 | Интернет-банк, АБС | Регистрация депозита | Deposit System вызывает АБС для проверки баланса и создания депозитного счёта. АБС регистрирует депозит. | F2.3, F4.1 |
| 8 | Веб-сайт, Система колл-центра | Передача заявки в колл-центр | Заявка с сайта передаётся через Deposit System в систему колл-центра через Kafka для обработки менеджером. | F1.2, F3 |
| 9 | Менеджер колл-центра, Система колл-центра | Предложение особых условий | Менеджер изучает заявку, запрашивает продукты, ставки и данные клиента у Deposit System, и предлагает особые условия. Результат отправляется в Deposit System через Kafka. | F3 |
| 10 | Менеджер бэк-офиса, АБС | Подтверждение условий депозита | Менеджер бэк-офиса подтверждает условия депозита в АБС (для заявок с сайта или особых условий). | F4.1 |
| 11 | АБС, Система отправки СМС | Уведомление о подтверждении ставки | Deposit System отправляет СМС-уведомление клиенту через СМС-шлюз после подтверждения размера ставки по депозиту. | F4.2 |
| 12 | АБС, Система отправки СМС | Уведомление об открытии депозита | Deposit System отправляет СМС-уведомление клиенту через СМС-шлюз после успешного открытия депозита. | F4.3 |
| 13 | Менеджер бэк-офиса депозитов, Back-Office UI | Управление ставками депозитов | Менеджер использует Back-Office UI для управления ставками через Deposit System, заменяя использование XLS-файлов. Deposit System сохраняет ставки в АБС. | F5.1 |
| 14 | Менеджер бэк-офиса кредитов, Back-Office UI | Просмотр актуальных ставок | Менеджер запрашивает актуальные ставки через Back-Office UI, Deposit System возвращает данные из АБС. | F5.2 |

# Нефункциональные и архитектурно-значимые требования

Таблица включает нефункциональные и архитектурно-значимые требования (помечены как [ASR]), с кодом из FURPS+ и пояснением их значимости.

| **№** | **Требование** | **Код FURPS+** | **Значимость** |
| :-: | :- | :- | :- |
| 1 | Высокая доступность системы (99.9% uptime). | R1 | Обеспечивает непрерывность работы для клиентов и сотрудников. |
| 2 | Время отклика сайта и интернет-банка на запросы клиента не более нескольких миллисекунд. | P1 | Критично для удобства пользователей и конверсии. |
| 3 | Обеспечение безопасности данных клиента с шифрованием трафика в соответствии с GDPR и локальными стандартами. [ASR] | +R5 | Требует выбора протоколов шифрования (TLS 1.3) и аутентификации (OAuth 2.0), влияющих на архитектуру. |
| 4 | Масштабируемость системы для поддержки горизонтального масштабирования запросов между серверами и ЦОД. [ASR] | P2 | Определяет использование API Gateway и Kafka для микросервисов. |
| 5 | Интеграция с существующими системами банка (АБС, система кол-центра, СМС-шлюз) через стандартные API (REST/SOAP). [ASR] | +R1 | Требует проектирования ABS Adapter и Kafka для асинхронной обработки. |
| 6 | Поддержка кросс-браузерной совместимости и адаптивного дизайна для сайта и интернет-банка (Chrome, Safari, Firefox, мобильные устройства). | U3 | Обеспечивает доступность для всех клиентов. |
| 7 | Автоматическое логирование операций для диагностики сбоев. | R3 | Упрощает устранение ошибок и мониторинг. |
| 8 | Поддержка переключения на резервный ЦОД в случае сбоя основного. | R2 | Гарантирует отказоустойчивость системы. |
| 9 | Использование существующих технологий банка (MS SQL, Oracle, знакомые языки программирования). [ASR] | S1 | Влияет на выбор Java (Spring Boot) и React для совместимости с IT-ландшафтом банка. |
| 10 | Реализация мониторинга и алертинга для новых сервисов. | S3 | Необходима для оперативного реагирования на инциденты. |
| 11 | Интерфейс сайта и интернет-банка должен соответствовать системе дизайна компании и быть интуитивно понятным. | U1.1, U1.2 | Повышает удобство и единообразие пользовательского опыта. |
| 12 | Упрощённый процесс подачи заявки с минимальным количеством полей (Ф.И.О., телефон на сайте; счёт, сумма в интернет-банке). | U2 | Увеличивает конверсию клиентов. |
| 13 | Оптимизация загрузки справочных данных для ускорения операций. | P3 | Устраняет проблемы с производительностью. |
| 14 | Асинхронная обработка запросов для взаимодействия с АБС, чтобы минимизировать нагрузку на её базу данных. [ASR] | +R7 | Требует внедрения Kafka для очередей сообщений, влияя на архитектуру интеграции. |

# Решение

## Логика принятия решений

Архитектура MVP разработана для быстрого внедрения, минимизации доработок АБС и полного соответствия всем функциональным (F1.1–F5.2) и нефункциональным (R1, P1, +R5, P2, +R1, U3, R3, R2, S1, S3, U1.1, U1.2, U2, P3, +R7) требованиям FURPS+. Основные решения и их связь с требованиями:

1. **Микросервисная архитектура**:
    - **Функциональные требования**: Поддерживает просмотр продуктов (F1.1, F2.1, F2.2) через Product Service, подачу заявок (F1.2, F2.3) через Application Service, отображение депозитных счетов (F2.3) через Account Service, операции с депозитами (F2.3, F4.1) через Deposit Service, уведомления (F4.2, F4.3) через Notification Service, и управление ставками (F5.1, F5.2) через Rates Service.
    - **Нефункциональные требования**:
        - **P2 (масштабируемость)**: Микросервисы масштабируются горизонтально, снижая нагрузку на АБС (+R4).
        - **S4 (Kafka)**: Kafka обеспечивает масштабируемость событий.
        - **S3 (мониторинг)**: Независимые сервисы упрощают мониторинг и алертинг.
        - **P3 (оптимизация данных)**: Account Service кэширует данные счетов в MS SQL, ускоряя отображение.
    - **Обоснование**: Микросервисы разделяют бизнес-логику, позволяя независимо разрабатывать и масштабировать компоненты, что критично для быстрого отклика (P1) и поддержки роста нагрузки (P2).

2. **Повторное использование АБС через ABS Adapter**:
    - **Функциональные требования**: АБС хранит данные счетов и выполняет операции (F2.3, F4.1, F5.1, F5.2). ABS Adapter предоставляет REST API для отображения счетов (F2.3), персонализации (F2.2), и управления ставками (F5.1, F5.2), а Kafka — для операций (F2.3, F4.1).
    - **Нефункциональные требования**:
        - **+R1 (интеграция через API)**: ABS Adapter обеспечивает REST API и Kafka для интеграции с АБС.
        - **+R4 (ограничения АБС)**: Минимизация доработок АБС, с фокусом на API и Kafka.
        - **+R7 (асинхронность)**: Kafka снижает нагрузку на базу АБС для операций.
    - **Обоснование**: АБС сохраняет роль хранилища данных и ядра операций, а ABS Adapter изолирует микросервисы от монолита, упрощая интеграцию и снижая риски изменений.

3. **Паттерн Outbox для асинхронной обработки**:
    - **Функциональные требования**: Application Service использует Outbox для надёжной передачи заявок (F1.2) в систему колл-центра и операций (F2.3) в Deposit Service через Kafka. Обратная связь от колл-центра (F3) также обрабатывается через Kafka.
    - **Нефункциональные требования**:
        - **+R7 (асинхронность)**: Outbox в Application Service (MS SQL) обеспечивает атомарную запись событий, снижая нагрузку на АБС.
        - **S4 (Kafka)**: Kafka масштабирует асинхронные события, поддерживая высокую пропускную способность.
        - **R3 (логирование)**: События в Outbox логируются, упрощая диагностику сбоев.
    - **Обоснование**: Паттерн Outbox гарантирует надёжную доставку событий (F1.2, F2.3, F3) даже при сбоях, минимизируя прямые вызовы АБС и поддерживая масштабируемость.

4. **Технологии (React, Spring Boot, MS SQL, Kafka)**:
    - **Функциональные требования**: React поддерживает адаптивные интерфейсы для веб-сайта (F1.1, F1.2), интернет-банка (F2.1–F2.4), и Back-Office UI (F5.1, F5.2). Spring Boot и MS SQL обеспечивают бизнес-логику и кэширование в микросервисах (F1.1–F5.2). Kafka поддерживает асинхронные заявки и операции (F1.2, F2.3, F4.1–F4.3).
    - **Нефункциональные требования**:
        - **S1 (существующие технологии)**: React, Spring Boot, MS SQL совместимы с IT-ландшафтом банка.
        - **U1.1, U1.2 (дизайн)**: React обеспечивает интуитивный и единообразный интерфейс.
        - **U3 (кросс-браузерность)**: React поддерживает Chrome, Safari, Firefox, мобильные устройства.
        - **S4 (Kafka)**: Kafka для масштабируемости событий.
        - **P1 (отклик)**: Spring Boot и MS SQL оптимизируют обработку запросов.
    - **Обоснование**: Выбранные технологии знакомы команде (S1), поддерживают быстрый отклик (P1), и обеспечивают удобство пользователей (U1.1, U1.2, U3).

5. **API Gateway и асинхронность через Kafka**:
    - **Функциональные требования**: API Gateway маршрутизирует запросы для продуктов (F1.1, F2.1, F2.2), заявок (F1.2, F2.3), счетов (F2.3), и ставок (F5.1, F5.2). Kafka обеспечивает асинхронную передачу заявок (F1.2), операций (F2.3, F4.1), и уведомлений (F4.2, F4.3).
    - **Нефункциональные требования**:
        - **+R1 (API)**: API Gateway (Nginx, OAuth 2.0) для REST API.
        - **+R5 (безопасность)**: OAuth 2.0 для аутентификации, TLS 1.3 для шифрования.
        - **+R7 (асинхронность)**: Kafka минимизирует нагрузку на АБС.
        - **P2 (масштабируемость)**: API Gateway балансирует нагрузку, Kafka масштабирует события.
        - **R3 (логирование)**: API Gateway и Kafka поддерживают логирование операций.
    - **Обоснование**: API Gateway централизует синхронные запросы, Kafka — асинхронные события, обеспечивая безопасность, масштабируемость, и надёжность.

6. **Интеграция системы колл-центра**:
    - **Функциональные требования**: Передача заявок (F1.2) через Deposit System в Kafka, обработка условий (F3) с доступом к продуктам, ставкам, и данным клиента.
    - **Нефункциональные требования**:
        - **+R1, +R7**: Kafka для асинхронной передачи заявок, REST API для данных.
        - **P2, S4**: Интеграция через Kafka масштабируема.
    - **Обоснование**: Двусторонняя связь Kafka между Deposit System и колл-центром обеспечивает надёжную и быструю обработку заявок.

7. **Отказоустойчивость и мониторинг**:
    - **Нефункциональные требования**:
        - **R1 (доступность)**: Микросервисы и API Gateway обеспечивают 99.9% uptime.
        - **R2 (резервный ЦОД)**: Архитектура поддерживает переключение на резервный ЦОД.
        - **S3 (мониторинг)**: Микросервисы и Kafka включают инструменты мониторинга.
        - **R3 (логирование)**: Логирование операций в микросервисах и API Gateway.
    - **Обоснование**: Распределённая архитектура и мониторинг гарантируют устойчивость и диагностику.

8. **Упрощённые формы и оптимизация**:
    - **Функциональные требования**: Минимальные поля для заявок (Ф.И.О., телефон на сайте, F1.2; счёт, сумма в интернет-банке, F2.3).
    - **Нефункциональные требования**:
        - **U2 (упрощённый процесс)**: Deposit System минимизирует поля ввода.
        - **P3 (оптимизация данных)**: Кэширование в Deposit System ускоряет запросы.
        - **P1 (отклик)**: Оптимизированная обработка в микросервисах.
    - **Обоснование**: Упрощённые формы и кэширование повышают конверсию (U2) и скорость (P1).

## Диаграммы C4

### Диаграмма контекста
(https://img.plantuml.biz/plantuml/png/dLR9RjDG5DrNwZ-Oi04fQJQiM34KYL6Kfbr7ByvhOkhOaUrGTLTI9gbCPGD2YAhY1zAAq3HJV-7wZpZtEN4y9GnIbEPDzzntphtdzORh2SThDSpbfKk6fPkjgjJgdjTqhnUBZjXPgHbUlLLfkTBHRSkJbhUYsutYC-4QfhrTAJPDONcRZnuM7Rdb5kjILDrYGnXMyVQrbQQAkhoq9XtNjgxefe7ZUIr7Nsb0FUhIo6_dUFo9pgY3cI6DwIVcp_tdVfjE_Ntg-ctDVuuFriynDwQXHZry-2nMzsZ4UmfqWWqZwlE6tDKGiYgRjcjuvOhGjylsrfQXIyOxzDzHlq1Z_mNr45rXNk3e6OQCSQgo-a4NYD-XKnhu7oQPO9ad-lWUKY-2f3ko-cUWFW9s0HU5ESBS61SSKiTlutSFyJj9E0Mrl5JQTJtPkB8ZAxYL3AZhqabXoeyA-5q5Fr6v_vg4KbS1kQ2q3vI3F5EAJSXaRxe56k2U0HhYh4kXGwrIqp6icdRBjZ5uLD9AJnxchcgNJQDMzofcIuP96QWEnvBCWRNDUNoPer6G94PTv721xzUHEuEADjFa7-0lQcIEE8kJgpbIMc5Y4KtABGE7Rs6Yy5XDQ9ltSh5SePIgFyQ5x1fuZ4f8dMnqHcssdAOvusDQUwuQujHgCA45wrCM5FydIlk36GifkQBgi7WWhSlLaKyGfAJTnpukCpG3EWrzXfKF-NWz0NwHj74AHSNbT3_I8HtFxur9IjmPoRIciyaEKlkuAaQu_P0xkp_pXgdOgz9irY7SOqVefiokFbsOPbcNN8CpnkcODMDXkRiqPGy36XJyLm40Ns6n3X7MOpuqAuELfw3cldWcuiMuPhlCuNnAtOPRhWbFxeZT8DDlT5pmtu3FztGMzd6AvKnfuwnrs093JB7Bnh4kpT1_8-unyvuniv6eE-OV0bqeL-v0taxA9EvkRAoLs9kY02ad-EZlAn4uknut4iiF4LHLmkSFGFoOuHCravya5CamBBD8RlnMA9_vfGACc8bKSfbFGSeQeeKz3PMs_TJ5Cym_7Jf9TXXs77XYB6GeKif6w3CEJMZvTy7MxvGsj9jhzwOu2Qt-7IrBaB_4JbAK1izIWqqYeofYL2QHaf4dVXQxM-X3_alSOwnUfhsWJ1FE5RjCNdiWjhR5FAHiNpfIiRkPJ06Abyv0yi1_ow3gMGmTIZsGGGuBaHC64tMJFaCgnyaYAolb_wgBXP9aeKnaEPhNrB0_Y3vW00pFWrSnKy648yuHR7dfXhIg-2_rDm00)

**Описание**:
- **Клиент**: Взаимодействует с веб-сайтом (просмотр продуктов, заявки) и интернет-банком (аутентификация, открытие депозитов, просмотр счетов).
- **Бэк-офис депозитов**: Управляет ставками через Back-Office UI (F5.1).
- **Бэк-офис кредитов**: Просматривает ставки через Back-Office UI (F5.2).
- **Веб-сайт**: Отображает депозитные продукты (F1.1) и собирает заявки (F1.2).
- **Интернет-банк**: Обрабатывает аутентифицированное открытие депозитов (F2.3), персонализированные предложения (F2.2), и отображение счетов (F2.3).
- **Back-Office UI**: Интерфейс для бэк-офиса депозитов и кредитов.
- **Deposit System**: Абстрагирует микросервисы (Product Service, Application Service, Account Service, Deposit Service, Notification Service, Rates Service), обрабатывает продукты, заявки, счета, депозиты, уведомления, ставки.
- **АБС**: Хранит данные счетов, выполняет операции (проверка баланса, регистрация депозитов, управление ставками).
- **Система колл-центра**: Обрабатывает заявки (F1.2), предлагает условия (F3).
- **СМС-шлюз**: Отправляет уведомления клиентам (F4.2, F4.3).

### Диаграмма контейнеров
(jLXjRzjK5FvUgV_X4hviKbuGujC-hHqJ3DQjDDqdGD6DupIcZctPJak59dKjOqCPRAkGG6XYLFo1j90sRTBqBrp_8yuvVidrQm82gUlg6_kyFSyvvt5kEowttLvNNrvwHpCKlTTIMSTrBUTMhMRptUgMvdPwpPwZseffkAhXLXMpMzlXZgQRsysQfNF3VRHslsQhRQVMKNdBgNMvPjJkV52roEhoqhfgEwPnGz4rUBpCIk9NCHOZCHHNta49hu_4kHZ0oKHCnLzmVk4zyGx4gNSeXju1yvx03tn-0MTJCM5Y13_uB7owBwxmdeeuWHkkn2NUKBePkMofbkbeRgF9bUs6sMvhYeh-Ndi_YCkAc7hVYX5O9v_NyEWvNAAFKuhg3t4DzWVYL8ozbq4ay34UNCBlYHX9dXHRRSrtT0a6X-1ETlCMpgQGu4GCl0FuUmJs1qbtv6fvQTNi6IrkxzreScExuUmvhjebFtxshCB4CNh2seY9ro_TPDyiBp5s1w03K5JxngxQX8AeVjM7ugGIbXPZsL2v0W3LBLipjjYgQSB5MftLFxjFaVv6KPzGKSw26Ab6W1fWTGdXzyk85Tm4KUo7jm2uKC0W3VQkhcrrtARUK-EHQS0ksr2nXiOsklib1-D58eLxXn38DVn-9bKK2ds087Xz-1yOc0KzHBXbgweHZqu2jj7JmCSg75GUqW5xT2yxfb8i3I01KHkT0gCOL59cXnYWQwjdMpfL9i8w975NKsmJ-d07N3fW-KF_dAt9vo7YSkoMRRPwYji8xe57r_qJLlTFCCwyKixeEKLw9W37Yb53NbE62FqLr1hR6r7_3X9x6M4UbLKEZbkMhYdSrKn32d1bThfGa3Gu1e3rO4QtAJG4XXPIziH77sxnAHgGu69EV8e2GCZ5M_5F5eahtZ4myB98TmM1FCLcVuOS3JcO7r78Xrb48HEo8w98VWUNV_gZ0QFnaScWlmycGNnAlOVreiuRO_U5DCsFpZ1ThPq6z85qN1GdLYmSk-JwMBmHnyKkRUwgZkHh0w-Bd4YJFG8bFTkJBX_79m9lEWtUuXPCBIJ5Qfsj-5U5X00ol8P6yNaO3e9NCC2Flp0-5yS11mQtyBEfH5keVNZxolgzufOJep8JFyd8UlqYWv_ozZOdarHiU7YH0e75AsI9rnSNNqhLudkfEc7cb6E9oAfR7PYW3sskw6h-fWqgWQxAIQ86fycGw3xS4T1IU0qBTwOqOesLNZ_SqXfRG9nTleTmGeq_ygymmWTRcl4rXBpISpli_Ufx5FKRgFQ-znp-7T8WYGOUX36WCz_l2ESxXfWQXybIALpN6ugAYr1Qxj96HywWnXcBSGMiaNsiNBH-gbz1iJ_XEpo-6jTD1taiiz1d0agE_cmzPctgZ6NeT1sfLZvhAjvpGEz7SPvgumZJGnmfI4D89E0Lib_6Q83oBLQVnwXxDbGzae-IWfc_cygCM9FQ3PWWMFXuStEzZj9ATf0I8g_omGJxs03OKlifaeREKSlIB3sZEwYTKjupfMfATImskbAPPOZJjEbaDIEpKrzpnKn6ACJxHlmCJrpxXhm-O8kx5bC_zIKEm8jKlLlVn34M6ajKF67ocDJ-KuBMR-qX0VdF_IHpdXTxQf4a3SOCf6MMR363d7CjPckZRBKJCBhONahB_6k5CizLSYTd4ZVI6WMiA_IIFJ2BguvUvpl9A7nQT_ajaokKoDF-8iAB1ZYjuS88ijDzI-w7kPI8sSqoaKCpb8pdKBUnzm93fDUdX9GU5JjBLIn77EQflgIzL8V5DLWS-4W907NZEwQ80MKMXo7PCOjwdDSigT8a3Fz_p4fqPiBlelibcKychn8fvUr2K0QGr9ZoXVUnScow5m5P05nMFF_9WCuod1fsijcviqQkKY2MZt2RORkHnWzLFNuJDjFHEObdjrX2iUNtcnpTyX8OKvcDOeoPRNbTeXwKDB8y6UAI4X99R-_GIMADLz6gEC8lHWuH1kzxrBoClXOyymKglRHxB-XbXbeYu2cxkmEGpC89NgmcsH8TIaargyI_203_gj728GNl1hVXprvN_ni0)
```plantuml
@startuml
!include https://raw.githubusercontent.com/vasilokb/plantUML/refs/heads/main/C4.puml

Person(client, "Клиент", "Взаимодействует с сайтом и интернет-банком")
Person(deposit_back_office, "Бэк-офис депозитов", "Управляет ставками")
Person(credit_back_office, "Бэк-офис кредитов", "Просматривает ставки")

Boundary(bank_system, "Банк - Системы") {
  Container(website, "Веб-сайт", "React, Spring Boot, MS SQL", "Отображает продукты, собирает заявки") #lightblue
  Container(internet_bank, "Интернет-банк", "React, Spring Boot, MS SQL", "Обеспечивает открытие депозитов") #green
  Container(back_office_ui, "Back-Office UI", "React, Spring Boot", "Интерфейс для бэк-офиса") #purple
  Boundary(deposit_microservices, "Deposit Microservices") {
    Container(product_service, "Product Service", "Spring Boot, MS SQL", "Просмотр продуктов и персонализация") #lightgreen
    Container(application_service, "Application Service", "Spring Boot, MS SQL", "Подача заявок и обработка событий") #lightgreen
    Container(account_service, "Account Service", "Spring Boot, MS SQL", "Отображение депозитных счетов") #lightgreen
    Container(deposit_service, "Deposit Service", "Spring Boot", "Регистрация депозитов и проверка баланса") #lightgreen
    Container(notification_service, "Notification Service", "Spring Boot", "Отправка СМС") #lightgreen
    Container(rates_service, "Rates Service", "Spring Boot", "Управление ставками") #lightgreen
  }
  Container(abs_adapter, "ABS Adapter", "Spring Boot, MS SQL", "Обёртка для АБС\n[Счета: доработан для API и персонализации, Депозиты: доработан для Kafka и СМС, Управление ставками: новый]") #lightgray
  Container(abs, "АБС", "Delphi, Oracle", "Управляет счетами, депозитами, ставками, данными клиентов") #lightblue
  Container(api_gateway, "API Gateway", "Nginx, OAuth 2.0", "Маршрутизация, аутентификация") #lightgray
  Container(call_center_system, "Система колл-центра", "React.js, Java Spring Boot, PostgreSQL", "Обрабатывает заявки") #lightgreen
  Container(sms_gateway, "СМС-шлюз", "Отправляет уведомления клиентам") #lightgray
}

Rel(client, website, "Просмотр продуктов, подача заявки", "HTTPS")
Rel(client, internet_bank, "Аутентификация, выбор депозита, подтверждение", "HTTPS")
Rel(deposit_back_office, back_office_ui, "Управление ставками", "HTTPS")
Rel(credit_back_office, back_office_ui, "Просмотр ставок", "HTTPS")
Rel(website, api_gateway, "Запросы к сервисам", "REST API")
Rel(internet_bank, api_gateway, "Синхронные запросы к сервисам", "REST API")
Rel(back_office_ui, api_gateway, "Запросы к Rates Service", "REST API")
Rel(api_gateway, product_service, "Запрос продуктов", "REST API")
Rel(api_gateway, application_service, "Подача заявки", "REST API")
Rel(api_gateway, account_service, "Отображение депозитных счетов", "REST API")
Rel(api_gateway, rates_service, "Управление и просмотр ставок", "REST API")
Rel(api_gateway, call_center_system, "Запрос продуктов и ставок", "REST API")
Rel(application_service, deposit_service, "Проверка баланса и регистрация депозита", "Kafka")
Rel(application_service, call_center_system, "Передача заявки", "Kafka")
Rel(call_center_system, application_service, "Результат обработки заявки", "Kafka")
Rel(deposit_service, notification_service, "Отправка СМС", "Kafka")
Rel(product_service, abs_adapter, "Запрос данных клиента и ставок", "REST API, Kafka")
Rel(account_service, abs_adapter, "Запрос данных счетов", "REST API")
Rel(deposit_service, abs_adapter, "Проверка баланса и регистрация депозита", "Kafka")
Rel(rates_service, abs_adapter, "Управление ставками", "REST API")
Rel(call_center_system, abs_adapter, "Подтверждение условий, запрос данных клиента", "REST API, Kafka")
Rel(call_center_system, product_service, "Запрос продуктов", "REST API")
Rel(call_center_system, rates_service, "Запрос ставок", "REST API")
Rel(abs_adapter, abs, "Все операции с АБС", "REST API, Kafka")
Rel(notification_service, sms_gateway, "Отправка СМС", "REST API")

note right of api_gateway
  API Gateway обрабатывает синхронные REST API запросы.
  В будущем может быть добавлен Event Gateway для маршрутизации Kafka-событий.
end note
@enduml
```

**Описание компонентов**:
- **Клиент**: Использует браузер для доступа к веб-сайту и интернет-банку.
- **Веб-сайт**: Обрабатывает просмотр продуктов (F1.1) и подачу заявок (F1.2).
- **Интернет-банк**: Обрабатывает аутентификацию, просмотр продуктов и счетов, подачу заявок (F2.1–F2.4).
- **Back-Office UI**: Интерфейс для бэк-офиса депозитов (F5.1) и кредитов (F5.2).
- **Deposit Microservices**:
    - **Product Service**: Возвращает продукты и персонализированные ставки (F1.1, F2.1, F2.2).
    - **Application Service**: Координирует заявки, записывает события в Outbox, публикует в Kafka (F1.2, F2.3).
    - **Account Service**: Отображает депозитные счета, кэширует данные из АБС (F2.3).
    - **Deposit Service**: Выполняет операции (проверка баланса, регистрация депозита, F2.3, F4.1).
    - **Notification Service**: Отправляет СМС через СМС-шлюз (F4.2, F4.3).
    - **Rates Service**: Управляет ставками через АБС (F5.1, F5.2).
- **ABS Adapter**: Маршрутизирует запросы к АБС, поддерживает REST API и Kafka.
- **АБС**: Монолит, хранит данные счетов, выполняет операции (F2.3, F4.1, F5.1, F5.2).
- **API Gateway**: Маршрутизирует REST API запросы, обеспечивает аутентификацию (OAuth 2.0).
- **Система колл-центра**: Обрабатывает заявки (F1.2), предлагает условия (F3), интегрирована с микросервисами.
- **СМС-шлюз**: Отправляет уведомления (F4.2, F4.3).

## Интеграции

- **Веб-сайт → Deposit System**: REST API для продуктов (F1.1) и заявок (F1.2).
- **Интернет-банк → Deposit System**: REST API для продуктов (F2.1, F2.2), заявок (F2.3), и счетов (F2.3).
- **Back-Office UI → Deposit System**: REST API для управления и просмотра ставок (F5.1, F5.2).
- **Deposit System → Система колл-центра**: Kafka для асинхронной передачи заявок и результатов обработки (F1.2, F3).
- **Система колл-центра → Deposit System**: REST API для продуктов, ставок; Kafka для результатов обработки (F3).
- **Deposit System → АБС**: REST API для данных клиента, счетов, ставок; Kafka для операций (F2.2, F2.3, F4.1, F5.1, F5.2).
- **Deposit System → СМС-шлюз**: REST API для отправки СМС (F4.2, F4.3).
- **Система колл-центра → АБС**: REST API и Kafka для данных клиента и подтверждения условий (F3).
- **Безопасность**: HTTPS для внешних взаимодействий, TLS 1.3 для внутренних, OAuth 2.0 через API Gateway.

## Альтернативы

1. **Монолитная архитектура**:
    - **Описание**: Вся логика (отображение счетов, операции) реализована в АБС, веб-сайт и интернет-банк — тонкие клиенты.
    - **Недостатки**: Ограниченная масштабируемость (+R4), высокая нагрузка на АБС, медленная разработка.
    - **Причина отказа**: Не соответствует требованиям производительности (P1, P2) и масштабируемости (P2, S4).

2. **Полная микросервисная декомпозиция АБС**:
    - **Описание**: Вынос всех функций АБС (счета, депозиты, ставки) в микросервисы, дублирование данных в MS SQL.
    - **Недостатки**: Высокая сложность, риски рассинхронизации данных, значительные изменения в АБС (+R4).
    - **Причина отказа**: Избыточна для MVP, увеличивает затраты и риски.

## Недостатки, ограничения, риски

- **Недостатки**:
    - Зависимость микросервисов от АБС для данных счетов и операций ограничивает производительность (+R4).
    - Ограниченная персонализация в MVP из-за минимальной доработки АБС (F2.2).
- **Ограничения**:
    - Поддержка только веб-версии сайта и интернет-банка (мобильное приложение вне MVP).
    - АБС масштабируется вертикально, что может стать узким местом (+R4).
- **Риски**:
    - Сбои в API Gateway или Kafka могут нарушить взаимодействие микросервисов.
    - Перегрузка АБС при пиковых нагрузках из-за ограничений базы данных (+R4).
    - Риски безопасности при неправильной настройке OAuth 2.0 или TLS 1.3 (+R5).